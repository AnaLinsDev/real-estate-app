// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-py"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// IMPORTANTE: photos and documents will be only a path to a local folder saving those images/pdf

//
// USUARIOS
//
model User {
  id             Int      @id @default(autoincrement())
  username       String
  email          String   @unique
  hashedPassword String
  createdAt      DateTime @default(now())
}


//
// IMOVEIS
//
model Property {
  id       Int      @id @default(autoincrement())
  name     String
  type     String
  address  String?
  status   String   @default("available")
  photos   String?  // URL to the file with the ONE photo
  notes    String?

  // relations
  occupations        Occupation[]
  investments        PropertyInvestment[]
  bills              PropertyBill[]
  property_photos    PropertyPhoto[]
}


//
// FOTOS DOS IMOVEIS
//
model PropertyPhoto {
  id          Int      @id @default(autoincrement())
  property_id Int
  url_photo   String

  property    Property @relation(fields: [property_id], references: [id])

  @@index([property_id])
}


//
// INQUILINOS
//
model Tenant {
  id         Int      @id @default(autoincrement())
  name       String
  phone      String?
  email      String?
  documents  String?  // JSON armazenado como texto
  notes      String?

  // relations
  occupations  Occupation[]
  bills        PropertyBill[]
}

//
// OCUPACAO
//
model Occupation {
  id          Int     @id @default(autoincrement())
  property_id Int
  tenant_id   Int
  start_date  String  // ISO string
  end_date    String?
  notes       String?

  // relations
  property  Property @relation(fields: [property_id], references: [id])
  tenant    Tenant   @relation(fields: [tenant_id], references: [id])
}

//
// GASTOS MENSAIS (INVESTIMENTOS)
//
model PropertyInvestment {
  id              Int      @id @default(autoincrement())
  property_id     Int
  description     String
  reference_month String   // YYYY-MM
  date            String   // YYYY-MM-DD
  amount          Float
  notes           String?

  // relation
  property Property @relation(fields: [property_id], references: [id])
}

//
// PAGAMENTOS / CONTAS
//
model PropertyBill {
  id              Int      @id @default(autoincrement())
  property_id     Int
  tenant_id       Int?
  bill_type       String
  reference_month String   // YYYY-MM
  due_date        String?
  paid_date       String?
  amount          Float
  notes           String?

  // relations
  property Property @relation(fields: [property_id], references: [id])
  tenant   Tenant?  @relation(fields: [tenant_id], references: [id])
}